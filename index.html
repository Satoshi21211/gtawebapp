<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>–í–æ–π–Ω–∞ –∂—É–∫–æ–≤ ‚Äî –±—Ä–∞—É–∑–µ—Ä–Ω–∞—è –∏–≥—Ä–∞</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
  <style>
    html, body, #gameContainer {
      margin: 0; padding: 0; width: 100vw; height: 100vh; background: #222;
      overflow: hidden;
    }
    #ui {
      position: absolute; left: 0; top: 0; width: 100vw; pointer-events: none; z-index: 9;
      font-family:Arial,sans-serif;
    }
    #ui .btn {
      pointer-events: all;
      display: inline-block;
      margin: 6px;
      padding: 13px 22px;
      background: #ffd800;
      color: #181824;
      border: none;
      border-radius: 14px;
      font-size: 1.2em;
      font-weight: bold;
      box-shadow: 0 2px 10px #ffd80055;
      cursor: pointer;
      transition: background .15s;
    }
    #ui .btn:active { background: #ffe66d; }
    #ui .panel {
      pointer-events: all;
      background: #19191eeb;
      color: #fff;
      border-radius: 16px;
      padding: 18px 18px 10px 18px;
      box-shadow: 0 4px 28px #000c;
      margin: 24px auto 0 auto;
      max-width: 330px;
      text-align: center;
      font-size: 1.13em;
    }
    @media (max-width:600px) {
      #ui .panel {max-width:95vw;padding:11px 4vw 7px 4vw;font-size:1em;}
      #ui .btn {padding:10px 13px;font-size:1em;margin:3px;}
    }
  </style>
</head>
<body>
<div id="gameContainer"></div>
<div id="ui"></div>
<script>
const W = window.innerWidth, H = window.innerHeight;
const config = {
    type: Phaser.AUTO,
    width: W,
    height: H,
    backgroundColor: "#69b4e1",
    parent: "gameContainer",
    scale: { mode: Phaser.Scale.RESIZE, autoCenter: Phaser.Scale.CENTER_BOTH },
    physics: { default: "arcade", arcade: { gravity: { y: 600 }, debug: false } },
    scene: { preload, create, update }
};

// --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï ---
let player, cursors, playerHp=100, playerMaxHp=100, playerWeapon="bite", playerHeal=1;
let shopOpen = false, ui = document.getElementById('ui');
let beetleSprite = 'https://i.imgur.com/4YXy2lO.png'; // –∑–∞–º–µ–Ω—è–π –Ω–∞ –ª—é–±–æ–π —Å–≤–æ–π
let medkitSprite = 'https://i.imgur.com/1nXKPJt.png'; // –∞–ø—Ç–µ—á–∫–∞
let gunSprite = 'https://i.imgur.com/0kB6Ftt.png'; // –æ—Ä—É–∂–∏–µ (–∏–∫–æ–Ω–∫–∞ –ø–∏—Å—Ç–æ–ª–µ—Ç–∞)
let enemy, bullets = [], lastShot = 0;

// --- –ü–†–ï–î–ó–ê–ì–†–£–ó–ö–ê --- 
function preload() {
    this.load.spritesheet('beetle', beetleSprite, { frameWidth: 64, frameHeight: 64 });
    this.load.image('ground', 'https://i.imgur.com/2R7b4lW.png');
    this.load.image('medkit', medkitSprite);
    this.load.image('gun', gunSprite);
}
function create() {
    // –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞
    for(let i=0; i<W/64+2; ++i)
      this.add.image(i*64, H-60, 'ground').setOrigin(0,0);
    let ground = this.physics.add.staticGroup();
    ground.create(W/2, H-30, 'ground').setScale(W/64,1).refreshBody();
    // –ò–≥—Ä–æ–∫-–∂—É–∫
    player = this.physics.add.sprite(120, H-100, 'beetle').setScale(1.5);
    player.setCollideWorldBounds(true);
    this.anims.create({key:'walk',frames:this.anims.generateFrameNumbers('beetle', {start:0,end:3}),frameRate:8,repeat:-1});
    this.physics.add.collider(player, ground);
    // –í—Ä–∞–≥-–∂—É–∫
    enemy = this.physics.add.sprite(W-120, H-100, 'beetle').setScale(1.5);
    enemy.setTint(0xff4444);
    this.physics.add.collider(enemy, ground);

    // –ö–ª–∞–≤–∏—à–∏/–∫–æ–Ω—Ç—Ä–æ–ª
    cursors = this.input.keyboard.createCursorKeys();
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª
    addTouchControls();

    // –ê–ø—Ç–µ—á–∫–∞
    let medkit = this.physics.add.sprite(W/2, H-150, 'medkit').setScale(1.2);
    this.physics.add.overlap(player, medkit, () => {
      playerHp = Math.min(playerHp+40, playerMaxHp);
      medkit.y = -1000; // —Å–ø—Ä—è—Ç–∞—Ç—å
      showMessage("üêû +40 HP! –ê–ø—Ç–µ—á–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞!");
    }, null, this);

    // –û—Ä—É–∂–∏–µ –Ω–∞ –ø–æ–ª–µ
    let gun = this.physics.add.sprite(W/2+80, H-160, 'gun').setScale(1);
    this.physics.add.overlap(player, gun, () => {
      playerWeapon = "gun";
      gun.y = -1000;
      showMessage("üî• –ü–∏—Å—Ç–æ–ª–µ—Ç —Å–æ–±—Ä–∞–Ω! –°—Ç—Ä–µ–ª—è–π –ø—Ä–æ–±–µ–ª–æ–º!");
    }, null, this);

    // –í—Ä–∞–≥ –¥–≤–∏–≥–∞–µ—Ç—Å—è (–ø—Ä–æ—Å—Ç–∞—è –ò–ò)
    this.time.addEvent({ delay: 1200, loop: true, callback: ()=>{
      if(!enemy.active) return;
      let dir = Math.sign(player.x-enemy.x);
      enemy.setVelocityX(90*dir);
      enemy.anims.play('walk', true);
      if(enemy.body.touching.down && Math.random()<0.5) enemy.setVelocityY(-220);
    }});

    // UI
    drawUI();
    window.addEventListener('resize', drawUI);
}
function update(time, delta) {
    // –î–≤–∏–∂–µ–Ω–∏–µ
    player.setVelocityX(0);
    if (cursors.left.isDown) { player.setVelocityX(-180); player.anims.play('walk', true); player.setFlipX(true);}
    else if (cursors.right.isDown) { player.setVelocityX(180); player.anims.play('walk', true); player.setFlipX(false);}
    else { player.anims.stop(); player.setFrame(0);}
    if (cursors.up.isDown && player.body.touching.down) player.setVelocityY(-320);

    // –û—Ä—É–∂–∏–µ
    if (playerWeapon=="gun" && cursors.space.isDown && time-lastShot>500) {
      lastShot = time;
      let bullet = player.scene.physics.add.image(player.x+35*(player.flipX?-1:1), player.y, 'gun').setScale(0.6);
      bullet.body.allowGravity = false;
      bullet.setVelocityX((player.flipX?-1:1)*400);
      bullets.push(bullet);
      setTimeout(()=>bullet.destroy(), 1800);
    }
    // –ü—É–ª–∏ –∏ –ø–æ–ø–∞–¥–∞–Ω–∏–µ –ø–æ –≤—Ä–∞–≥—É
    bullets.forEach(b=>{
      if(enemy.active && Phaser.Geom.Intersects.RectangleToRectangle(b.getBounds(), enemy.getBounds())) {
        b.destroy(); enemyHp-=20;
        if(enemyHp<=0) { enemy.destroy(); showMessage("üéâ –ü–æ–±–µ–¥–∞!"); }
      }
    });

    // –í—Ä–∞–≥-–∞—Ç–∞–∫–∞ (–∫–∞—Å–∞–Ω–∏–µ)
    if(enemy.active && Phaser.Geom.Intersects.RectangleToRectangle(player.getBounds(), enemy.getBounds()) && playerHp>0) {
      playerHp -= 0.07 * delta;
      if(playerHp<=0) {
        playerHp=0; player.setTint(0x333333); player.anims.stop();
        showMessage("üíÄ –¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª!");
      }
    }
    updateUI();
}
let enemyHp=100;
function drawUI() {
    ui.innerHTML = `
    <div class="panel">
      <div>üêû <b>HP:</b> <span id="hp">${playerHp}</span>/<span id="mhp">${playerMaxHp}</span></div>
      <div>üß∞ <b>–õ–µ—á–µ–Ω–∏–µ:</b> <span id="heal">${playerHeal}</span></div>
      <div>üî´ <b>–û—Ä—É–∂–∏–µ:</b> <span id="weap">${playerWeapon=="gun"?"–ü–∏—Å—Ç–æ–ª–µ—Ç":"–ñ–≤–∞–ª–æ"}</span></div>
      <button class="btn" onclick="openShop()">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="btn" onclick="window.location.reload()">–†–µ—Å—Ç–∞—Ä—Ç</button>
    </div>
    `;
}
function updateUI() {
    document.getElementById('hp').textContent = Math.round(playerHp);
    document.getElementById('mhp').textContent = playerMaxHp;
    document.getElementById('heal').textContent = playerHeal;
    document.getElementById('weap').textContent = playerWeapon=="gun"?"–ü–∏—Å—Ç–æ–ª–µ—Ç":"–ñ–≤–∞–ª–æ";
}
function showMessage(txt) {
    let e = document.createElement('div');
    e.className='panel'; e.style.background='#2e4437f2'; e.textContent=txt;
    e.style.position='fixed'; e.style.left='50%'; e.style.top='18px'; e.style.transform='translateX(-50%)';
    e.style.zIndex='100'; e.style.transition='opacity .4s';
    document.body.appendChild(e);
    setTimeout(()=>e.style.opacity=0, 1500);
    setTimeout(()=>e.remove(), 1900);
}
// –ú–∞–≥–∞–∑–∏–Ω
function openShop() {
    if(shopOpen) return;
    shopOpen = true;
    let shop = document.createElement('div');
    shop.className = "panel";
    shop.style.position="fixed"; shop.style.left="50%"; shop.style.top="60px"; shop.style.transform="translateX(-50%)";
    shop.style.zIndex="200";
    shop.innerHTML = `
      <b>–ú–∞–≥–∞–∑–∏–Ω</b><br>
      <button class="btn" onclick="buy('heal')">–ê–ø—Ç–µ—á–∫–∞ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</button>
      <button class="btn" onclick="buy('gun')">–ü–∏—Å—Ç–æ–ª–µ—Ç (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</button>
      <button class="btn" onclick="buy('beetle')">–ö—É–ø–∏—Ç—å –∂—É–∫–∞ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</button>
      <br><br>
      <button class="btn" onclick="closeShop()">–ó–∞–∫—Ä—ã—Ç—å</button>
    `;
    document.body.appendChild(shop);
}
function closeShop() {
    let panels = document.querySelectorAll('.panel');
    panels.forEach(p=>{
      if(p.textContent.includes("–ú–∞–≥–∞–∑–∏–Ω")) p.remove();
    });
    shopOpen = false;
}
function buy(item) {
    if(item=="heal") { playerHp=Math.min(playerHp+50,playerMaxHp); showMessage("–ê–ø—Ç–µ—á–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞!"); }
    if(item=="gun") { playerWeapon="gun"; showMessage("–ü–∏—Å—Ç–æ–ª–µ—Ç –≤—ã–¥–∞–Ω!"); }
    if(item=="beetle") { playerHeal+=1; showMessage("–î–æ–±–∞–≤–ª–µ–Ω +1 –∫ –ª–µ—á–µ–Ω–∏—é!"); }
    closeShop();
    updateUI();
}
// —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª
function addTouchControls() {
    if(window.innerWidth<700) {
      let d=document.createElement('div');
      d.style.position='fixed';d.style.bottom='10px';d.style.left='0';d.style.width='100vw';d.style.textAlign='center';d.style.zIndex=999;
      d.innerHTML = `
        <button class="btn" style="margin-right:15vw;" ontouchstart="moveLeft(1)" ontouchend="moveLeft(0)">‚Üê</button>
        <button class="btn" style="margin-right:15vw;" ontouchstart="moveRight(1)" ontouchend="moveRight(0)">‚Üí</button>
        <button class="btn" style="margin-left:12vw;" ontouchstart="jump()">‚§í</button>
        <button class="btn" style="margin-left:8vw;" ontouchstart="fire()">üî´</button>
      `;
      document.body.appendChild(d);
      window.moveLeft = f=>{cursors.left.isDown=!!f;}
      window.moveRight = f=>{cursors.right.isDown=!!f;}
      window.jump = ()=>{cursors.up.isDown=true; setTimeout(()=>cursors.up.isDown=false,200);}
      window.fire = ()=>{cursors.space.isDown=true; setTimeout(()=>cursors.space.isDown=false,120);}
    }
}
window.openShop = openShop;
window.closeShop = closeShop;
window.buy = buy;
new Phaser.Game(config);
</script>
</body>
</html>
